<html>

<body>
    <script type="module">
        import {
            createSignal,
            createEffect,
            onCleanup,
            on,
            For
        } from "https://cdn.skypack.dev/solid-js";
        import { render } from "https://cdn.skypack.dev/solid-js/web";
        import html from "https://cdn.skypack.dev/solid-js/html";

        const App = () => {
            const [fieldList, setFieldList] = createSignal([], { equals: false });
            const [code, setCode] = createSignal("");

            createEffect(on(fieldList, v => {
                setCode(v.map(element => `<input name="${element.name}" type="${element.type}"/>`).join("\n"));
            }));

            return html`
            <div>
                <div>
                    <${For} each="${() => fieldList()}">
                        ${(field, index) => {
                            const renderOption = (type, v) => type == 
                                v 
                                ?
                                html`<option value="${v}" selected>${v}</option>`
                                : 
                                html`<option value="${v}">${v}</option>`;

                            return (
                                html`<div>
                                    <input type="text" placeholder="field name" value="${field.name}"
                                        onchange="${e => {
                                            setFieldList(a => {
                                                const newArr = a.map((element, elementIndex) => {
                                                    if (elementIndex == index()) {
                                                        return ({...element, name: e.currentTarget.value })
                                                    } else {
                                                        return element;
                                                    }
                                                });
                                                return newArr;
                                            })
                                        }}"
                                    />
                                    <select onchange="${e => {
                                        setFieldList(a => {
                                            const newArr = a.map((element, elementIndex) => {
                                                if (elementIndex == index()) {
                                                    return ({...element, type: e.currentTarget.value })
                                                } else {
                                                    return element;
                                                }
                                            });
                                            return newArr;
                                        })
                                    }}">
                                        ${renderOption(field.type, "number")}
                                        ${renderOption(field.type, "text")}
                                        ${renderOption(field.type, "checkbox")}
                                        ${renderOption(field.type, "date")}
                                        ${renderOption(field.type, "datetime-local")}
                                        ${renderOption(field.type, "email")}
                                        ${renderOption(field.type, "file")}
                                        ${renderOption(field.type, "image")}
                                        ${renderOption(field.type, "month")}
                                        ${renderOption(field.type, "password")}
                                        ${renderOption(field.type, "radio")}
                                        ${renderOption(field.type, "range")}
                                        ${renderOption(field.type, "tel")}
                                        ${renderOption(field.type, "url")}
                                        ${renderOption(field.type, "week")}
                                    </select>
                                    <button onclick="${() => {
                                        setFieldList(a => {
                                            return a.filter((_, a_index) => a_index != index())
                                        });
                                    }}">-</button>
                                </div>`
                            )
                        }}
                    <//>
                    <button onclick="${() => {
                        setFieldList(a => {
                            return [...a, {name: "", type: "text"}]
                        });
                    }}">+</button>
                </div>
                <pre>${code}</pre>
                <div style="display: flex; flex-direction: column; max-width: 500px" innerHTML=${code}/>
            </div>
            `;
            // // or
            // return h("div", {}, count);
        };

        render(App, document.body);
    </script>
</body>

</html>

